---
title: Підключення до облікового запису Azure Data Lake Storage Gen2 за допомогою принципала служби
description: Скористайтеся принципалом служби для аналізу аудиторій Azure, щоб підключитися до власного озера даних під час вкладення в аналіз аудиторії.
ms.date: 11/24/2020
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: conceptual
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
ms.openlocfilehash: c2fae278d34fa02b9168ac70dfa8dd351653245e
ms.sourcegitcommit: 6a6df62fa12dcb9bd5f5a39cc3ee0e2b3988184b
ms.translationtype: HT
ms.contentlocale: uk-UA
ms.lasthandoff: 11/25/2020
ms.locfileid: "4644113"
---
# <a name="connect-to-an-azure-data-lake-storage-gen2-account-with-an-azure-service-principal-for-audience-insights"></a>Для аналізу аудиторії підключіться до облікового запису Azure Data Lake Storage Gen2 за допомогою принципала служби Azure

Для автоматичних інструментів, які використовують служби Azure, завжди мають обмежені дозволи. Замість того, щоб входити в програму як привілейований користувач, Azure пропонує принципали служби. Ознайомтеся, щоб дізнатися, як підключити аналізи аудиторі з обліковим записом Azure Data Lake Storage Gen2 за допомогою принципала служби Azure, а не ключів облікового запису сховища. 

Принципал служби можна використовувати для того, щоб безпечно [додавати або редагувати папку Common Data Model як джерело даних](connect-common-data-model.md) або [створювати нове або оновлювати наявне середовище](manage-environments.md#create-an-environment-in-an-existing-organization).

Для створення принципала служби потрібно мати дозвіл адміністратора для вашої підписки Azure.

## <a name="create-azure-service-principal-for-audience-insights"></a>Створення принципала служби Azure для аналізу аудиторії.

Перш ніж створити новий принципал служби для аналізу аудиторій, перевірте, чи він вже існує в організації.

### <a name="look-for-an-existing-service-principal"></a>Знайдіть наявний принципал служби

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com) та ввійдіть в організацію.

2. Виберіть **Azure Active Directory** у службах Azure.

3. У розділі **Керування** виберіть **Програма підприємства**.

4. Знайдіть ідентифікатор першої програми аналізу аудиторії `0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff` або ім’я `Dynamics 365 AI for Customer Insights`.

5. Якщо ви знайдете відповідний запис, це означає, що існує принципал служби для аналізу аудиторії. Не потрібно створювати його повторно.
   
   :::image type="content" source="media/ADLS-SP-AlreadyProvisioned.png" alt-text="Скріншот показує наявний принципал служби.":::
   
6. Якщо результатів не буде знайдено, створіть новий принципал служби.

### <a name="create-a-new-service-principal"></a>Створення нового принципалу служби

1. Інсталюйте найновішу версію **Azure Active Directory PowerShell для графа**. Для отримання додаткових відомостей див. розділ [Інсталяція Azure Active Directory PowerShell для графа](https://docs.microsoft.com/powershell/azure/active-directory/install-adv2).
   - Натисніть клавішу Windows на клавіатурі комп’ютера і знайдіть **Windows PowerShell** і **Запустити як адміністратор**.
   
   - У вікні PowerShell, що відкриється, введіть `Install-Module AzureAD`.

2. Створення принципалу служби для аналізу аудиторії за допомогою модуля Azure AD PowerShell.
   - У вікні PowerShell введіть `Connect-AzureAD -TenantId "[your tenant ID]" -AzureEnvironmentName Azure`. Замініть «ваш ідентифікатор клієнта» на фактичний ІДЕНТИФІКАТОР клієнта, в якому потрібно створити принципал служби. Параметр назви середовища `AzureEnvironmentName` є необов’язковим.
  
   - Введіть `New-AzureADServicePrincipal -AppId "0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff" -DisplayName "Dynamics 365 AI for Customer Insights"`. Ця команда створює принципал служби для аналізу аудиторії у вибраному клієнті.  

## <a name="grant-permissions-to-the-service-principal-to-access-the-storage-account"></a>Надання дозволів для принципала служби для доступу до облікового запису сховища

Відкрийте портал Azure, щоб надати дозволи принципалам служби для облікового запису сховища, який ви хочете використати в аналізі аудиторії.

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com) та ввійдіть в організацію.

1. Відкрийте обліковий запис сховища, для якого має мати дозвіл принципал служби для аналізу аудиторії.

1. Виберіть **Керування доступом (IAM)** на панелі переходів і натисніть **Додати** > **Додати призначення ролі**.
   
   :::image type="content" source="media/ADLS-SP-AddRoleAssignment.png" alt-text="Скріншот, на якому зображено портал Azure під час додавання призначення ролі.":::
   
1. В області **Додавання призначення ролі** встановіть такі властивості:
   - Роль: *Постачальник даних BLOB-об’єктів сховища*
   - Призначення доступу для: *Користувач, група або принципал служби*
   - Виберіть: *Dynamics 365 AI для Customer Insights* ([створений принципал служби](#create-a-new-service-principal))

1.  Виберіть **Зберегти**.

Для впровадження змін може знадобитися до 15 хвилин.

## <a name="enter-the-azure-resource-id-or-the-azure-subscription-details-in-the-storage-account-attachment-to-audience-insights"></a>Введіть ідентифікатор ресурсу Azure або деталі підписки Azure у вкладенні облікового запису сховища до аналізу аудиторії.

Прикріпіть обліковий запис сховища Azure Data Lake у аналізі аудиторії до [store output data](manage-environments.md) або [використовуйте його як джерело даних](connect-common-data-service-lake.md). Вибір параметра Azure Data Lake дає змогу вибирати між підходом на основі ресурсу та підходом на основі передплати.

Виконайте наведені нижче кроки, щоб надати необхідну інформацію щодо вибраного підходу.

### <a name="resounce-based-storage-account-connection"></a>Підключення облікового запису сховища на основі ресурсу

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com), увійдіть у підписку та відкрийте обліковий запис сховища.

1. В області переходів натисніть **Налаштування** > **Властивості**.

1. Скопіюйте значення ідентифікатора ресурсів облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-ResourceId.png" alt-text="Скопіюйте значення ідентифікатора ресурсів облікового запису сховища.":::

1. У аналізі аудиторії вставте ідентифікатор ресурсу у поле ресурсу, відображене на екрані підключення облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-ResourceIdConnection.png" alt-text="Введіть інформацію про ідентифікатор ресурсу облікового запису сховища.":::   
   
1. Продовжуйте дії, які залишилися в аналізі аудиторії, щоб прикріпити обліковий запис сховища.

### <a name="subscription-based-storage-account-connection"></a>Підключення облікового запису сховища на основі передплати

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com), увійдіть у підписку та відкрийте обліковий запис сховища.

1. В області переходів натисніть **Налаштування** > **Властивості**.

1. Перевірте **Передплату**, **Групу ресурсів** і **Ім’я** облікового запису сховища, щоб перевірити, що ви вибрали правильні значення у аналізі аудиторії.

1. У аналізі аудиторії виберіть значення або відповідні поля під час прикріплення облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-SubscriptionConnection.png" alt-text="Введіть інформацію про ідентифікатор ресурсу облікового запису сховища.":::
   
1. Продовжуйте дії, які залишилися в аналізі аудиторії, щоб прикріпити обліковий запис сховища.
