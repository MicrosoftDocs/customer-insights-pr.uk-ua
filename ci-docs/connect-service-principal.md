---
title: Підключення до облікового запису Azure Data Lake Storage за допомогою принципала служби Azure
description: Використайте принципала служби Azure, щоб підключатися до власного data lake.
ms.date: 05/31/2022
ms.subservice: audience-insights
ms.topic: how-to
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
searchScope:
- ci-system-security
- customerInsights
ms.openlocfilehash: 949caa73578dbe0a511726ec045c0fd5f4621de4
ms.sourcegitcommit: dca46afb9e23ba87a0ff59a1776c1d139e209a32
ms.translationtype: MT
ms.contentlocale: uk-UA
ms.lasthandoff: 06/29/2022
ms.locfileid: "9082250"
---
# <a name="connect-to-an-azure-data-lake-storage-account-by-using-an-azure-service-principal"></a>Підключення до облікового запису Azure Data Lake Storage за допомогою принципала служби Azure

У цій статті описано, як підключитися Dynamics 365 Customer Insights до облікового Azure Data Lake Storage запису за допомогою принципала служби Azure замість ключів облікового запису сховища.

Для автоматичних інструментів, які використовують служби Azure, завжди мають обмежені дозволи. Замість того, щоб входити в програму як привілейований користувач, Azure пропонує принципали служби. За допомогою принципів обслуговування можна безпечно [додавати або редагувати папку "Загальна модель даних" як джерело даних](connect-common-data-model.md) або створювати чи [оновлювати середовище](create-environment.md).

> [!IMPORTANT]
>
> - Обліковий запис Data Lake Storage, який буде використовувати принцип обслуговування, повинен бути Gen2 і мати [включений ієрархічний простір імен](/azure/storage/blobs/data-lake-storage-namespace). Облікові записи сховища Azure Data Lake Gen1 не підтримуються.
> - Для створення принципала служби потрібні дозволи адміністратора для клієнт Azure.

## <a name="create-an-azure-service-principal-for-customer-insights"></a>Створення принципала служби Azure для Customer Insights

Перш ніж створювати новий директор служби Customer Insights, перевірте, чи існує він уже у вашій організації.

### <a name="look-for-an-existing-service-principal"></a>Знайдіть наявний принципал служби

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com) та ввійдіть в організацію.

2. У розділі **Служби Azure**, виберіть **Azure Active Directory**.

3. У розділі **Керування** виберіть пункт **Програма** Microsoft.

4. Додайте фільтр для **ідентифікатора програми, щоб почати з**`0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff` імені або знайти його `Dynamics 365 AI for Customer Insights`.

5. Якщо знайдете відповідний запис, це означає, що принципал служби вже існує.

   :::image type="content" source="media/ADLS-SP-AlreadyProvisioned.png" alt-text="Знімок екрана: наявний принципал служби.":::

6. Якщо результати не повертаються, можна [створити новий принцип обслуговування](#create-a-new-service-principal). У більшості випадків він вже існує, і вам потрібно лише надати дозволи для довірителя служби для доступу до облікового запису сховища.

## <a name="grant-permissions-to-the-service-principal-to-access-the-storage-account"></a>Надання дозволів для принципала служби для доступу до облікового запису сховища

Перейдіть на портал Azure, щоб надати дозволи принципалу служби для облікового запису сховища, який потрібно використовувати в Customer Insights. Для облікового запису або контейнера сховища має бути призначена одна з таких ролей:

|Облікових даних|Вимоги|
|----------|------------|
|В даний час увійшов в систему користувач|**Роль**: Зчитувач даних BLOB-сховища, постачальник BLOB для зберігання або власник BLOB-сховища.<br>**Рівень**: дозволи можуть надаватися в обліковому записі сховища або контейнері.</br>|
|Директор служби Customer Insights -<br>Використання Azure Data Lake Storage в якості джерело даних</br>|Варіант 1<ul><li>**Роль**: Зчитувач даних BLOB зберігання, постачальник даних BLOB для зберігання або власник даних BLOB для зберігання.</li><li>**Рівень**: дозволи мають надаватися в обліковому записі сховища.</li></ul>Варіант 2 *(без спільного доступу Довірителя служби до облікового запису сховища)*<ul><li>**Роль 1**: Зчитувач даних BLOB для зберігання, постачальник даних BLOB для зберігання або власник даних BLOB для зберігання.</li><li>**Рівень**: Дозволи повинні надаватися на контейнер.</li><li>**Роль 2**: Делегатор даних BLOB для зберігання.</li><li>**Рівень**: дозволи мають надаватися в обліковому записі сховища.</li></ul>|
|Директор служби Customer Insights - <br>Використання Azure Data Lake Storage як виводу або призначення</br>|Варіант 1<ul><li>**Роль**: Постачальник даних BLOB зберігання або власник BLOB-сховища.</li><li>**Рівень**: дозволи мають надаватися в обліковому записі сховища.</li></ul>Варіант 2 *(без спільного доступу Довірителя служби до облікового запису сховища)*<ul><li>**Роль**: Постачальник даних BLOB зберігання або власник BLOB-сховища.</li><li>**Рівень**: Дозволи повинні надаватися на контейнер.</li><li>**Роль 2**: Делегатор зберігання ляпів.</li><li>**Рівень**: дозволи мають надаватися в обліковому записі сховища.</li></ul>|

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com) та ввійдіть в організацію.

1. Відкрийте обліковий запис сховища, до якого потрібно отримати доступ до основної служби Customer Insights.

1. В області ліворуч натисніть **Керування доступом (IAM)**, а потім **Додати** > **Додати призначення ролі**.

   :::image type="content" source="media/ADLS-SP-AddRoleAssignment.png" alt-text="Знімок екрана: портал Azure під час додавання призначення ролі.":::

1. В області **Додавання призначення ролі** задайте такі властивості:
   - Роль: зчитувач даних BLOB-сховища, постачальник blob-накопичувача або власник BLOB сховища на основі облікових даних, перелічених вище.
   - Призначення доступу для: **Користувач, група або принципал служби**
   - Виберіть учасників: **Dynamics 365 AI for Customer Insights (директор служби,**[який ви шукали](#create-a-new-service-principal) раніше в цій процедурі)

1. Виберіть елемент **Рецензування + призначити**.

Для впровадження змін може знадобитися до 15 хвилин.

## <a name="enter-the-azure-resource-id-or-the-azure-subscription-details-in-the-storage-account-attachment-to-customer-insights"></a>Введіть ідентифікатор ресурсу Azure або дані про передплату Azure у вкладеному обліковому записі сховища в Customer Insights

Ви можете прикріпити обліковий запис Data Lake Storage в Customer Insights, щоб [зберігати вихідні дані](manage-environments.md) або [використовувати їх як джерело даних](connect-dataverse-managed-lake.md). Цей параметр дає змогу вибрати підхід на основі ресурсів чи підписки. Залежно від вибраного підходу, дотримуйтеся процедури в одному з наведених нижче розділів.

### <a name="resource-based-storage-account-connection"></a>Підключення облікового запису сховища на основі ресурсу

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com), увійдіть у підписку та відкрийте обліковий запис сховища.

1. В області ліворуч перейдіть до **розділу Настройки** > **Кінцеві** точки.

1. Скопіюйте значення ідентифікатора ресурсів облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-ResourceId.png" alt-text="Скопіюйте значення ідентифікатора ресурсів облікового запису сховища.":::

1. У Customer Insights вставте ідентифікатор ресурсу в поле ресурсів, що відображається на екрані підключення облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-ResourceIdConnection.png" alt-text="Введіть інформацію про ідентифікатор ресурсу облікового запису сховища.":::   

1. Виконайте решту кроків у Customer Insights, щоб приєднати обліковий запис сховища.

### <a name="subscription-based-storage-account-connection"></a>Підключення облікового запису сховища на основі передплати

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com), увійдіть у підписку та відкрийте обліковий запис сховища.

1. В області ліворуч перейдіть до меню **Параметри** > **Властивості**.

1. Перегляньте статтю **"Передплата**", **"Ресурси"** та **"Ім'я** облікового запису сховища", щоб переконатися, що в аналітичних даних клієнтів вибрано правильні значення.

1. У розділі Customer Insights виберіть значення для відповідних полів під час прикріплення облікового запису сховища.

1. Виконайте решту кроків у Customer Insights, щоб приєднати обліковий запис сховища.

### <a name="create-a-new-service-principal"></a>Створення нового принципалу служби

1. Встановіть найновішу версію Azure Active Directory PowerShell for Graph. Для отримання додаткових відомостей, перейдіть до розділу [Встановлення Azure Active Directory PowerShell for Graph](/powershell/azure/active-directory/install-adv2).

   1. На ПК натисніть клавішу Windows на клавіатурі, знайдіть оболонку **Windows PowerShell** і виберіть пункт **Запуск від імені адміністратора**.

   1. У вікні PowerShell, що відкриється, введіть `Install-Module AzureAD`.

2. Створіть принципала служби для Customer Insights з модулем Azure AD PowerShell.

   1. У вікні PowerShell введіть `Connect-AzureAD -TenantId "[your Directory ID]" -AzureEnvironmentName Azure`. Замініть *[свій ідентифікатор каталогу]* фактичним ідентифікатором каталогу вашої передплати Azure, де ви хочете створити основну службу. Параметр назви середовища `AzureEnvironmentName` не обов'язковий.
  
   1. Введіть `New-AzureADServicePrincipal -AppId "0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff" -DisplayName "Dynamics 365 AI for Customer Insights"`. Ця команда створює принцип служби Customer Insights для вибраної передплати Azure.

[!INCLUDE [footer-include](includes/footer-banner.md)]
