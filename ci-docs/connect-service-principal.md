---
title: Підключення до облікового запису Azure Data Lake Storage за допомогою принципала служби Azure
description: Використайте принципала служби Azure, щоб підключатися до власного data lake.
ms.date: 08/12/2022
ms.subservice: audience-insights
ms.topic: how-to
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
searchScope:
- ci-system-security
- customerInsights
ms.openlocfilehash: eba10068c48db5c147100c25a397bcc13b014784
ms.sourcegitcommit: 267c317e10166146c9ac2c30560c479c9a005845
ms.translationtype: MT
ms.contentlocale: uk-UA
ms.lasthandoff: 08/16/2022
ms.locfileid: "9304222"
---
# <a name="connect-to-an-azure-data-lake-storage-account-by-using-an-azure-service-principal"></a>Підключення до облікового запису Azure Data Lake Storage за допомогою принципала служби Azure

Dynamics 365 Customer Insights надає можливість підключення до облікового Azure Data Lake Storage запису за допомогою принципала служби Azure замість ключів облікового запису сховища.

Автоматизовані інструменти, які використовують служби Azure, повинні мати обмежені дозволи. Замість того, щоб входити в програму як привілейований користувач, Azure пропонує принципали служби. Використовуйте принципи служб для безпечного [додавання або редагування папки «Загальна модель даних» як джерело даних](connect-common-data-model.md) або [створення чи оновлення середовища](create-environment.md).

## <a name="prerequisites"></a>вимоги

- Обліковий запис Data Lake Storage, який використовуватиме принципал послуги, має бути Gen2. Облікові записи сховища Azure Data Lake Gen1 не підтримуються.
- Обліковий запис Data Lake Storage має [ієрархічний простір імен](/azure/storage/blobs/data-lake-storage-namespace).
- Дозволи адміністратора для вашого клієнт Azure, якщо потрібно створити новий принципал служби.

## <a name="create-an-azure-service-principal-for-customer-insights"></a>Створення принципала служби Azure для Customer Insights

Перш ніж створювати новий принцип послуг для Customer Insights, перевірте, чи існує він уже у вашій організації. У більшості випадків вона вже існує.

### <a name="look-for-an-existing-service-principal"></a>Знайдіть наявний принципал служби

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com) та ввійдіть в організацію.

2. У розділі **Служби Azure**, виберіть **Azure Active Directory**.

3. У розділі **Керування** виберіть пункт **Програма** Microsoft.

4. Додайте фільтр для **ідентифікатора програми, почніть з**`0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff` імені або знайдіть його `Dynamics 365 AI for Customer Insights`.

5. Якщо знайдете відповідний запис, це означає, що принципал служби вже існує. [Надання дозволу](#grant-permissions-to-the-service-principal-to-access-the-storage-account) принципалу служби на доступ до облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-AlreadyProvisioned.png" alt-text="Знімок екрана: наявний принципал служби.":::

6. Якщо результати не повертаються, [створіть новий принцип служби](#create-a-new-service-principal).

### <a name="create-a-new-service-principal"></a>Створення нового принципалу служби

1. Встановіть найновішу версію Azure Active Directory PowerShell for Graph. Для отримання додаткових відомостей, перейдіть до розділу [Встановлення Azure Active Directory PowerShell for Graph](/powershell/azure/active-directory/install-adv2).

   1. На ПК натисніть клавішу Windows на клавіатурі, знайдіть **Windows PowerShell** і виберіть запуск із **правами адміністратора**.

   1. У вікні PowerShell, що відкриється, введіть `Install-Module AzureAD`.

2. Створіть принципала служби для Customer Insights з модулем Azure AD PowerShell.

   1. У вікні PowerShell введіть `Connect-AzureAD -TenantId "[your Directory ID]" -AzureEnvironmentName Azure`. Замініть *[ваш ідентифікатор каталогу]* фактичним ідентифікатором каталогу вашої підписки Azure, де ви хочете створити принцип служби. Параметр назви середовища `AzureEnvironmentName` не обов'язковий.
  
   1. Введіть `New-AzureADServicePrincipal -AppId "0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff" -DisplayName "Dynamics 365 AI for Customer Insights"`. Ця команда створює принцип обслуговування для Customer Insights для вибраної передплати Azure.

## <a name="grant-permissions-to-the-service-principal-to-access-the-storage-account"></a>Надання дозволів для принципала служби для доступу до облікового запису сховища

Щоб надати дозволи принципалу служби для облікового запису сховища, який потрібно використовувати в Customer Insights, обліковому запису сховища або контейнеру має бути призначена одна з таких ролей:

|Облікових даних|Вимоги|
|----------|------------|
|В даний час зареєстрований користувач|**Роль**: переглядач даних BLOB-сховища, постачальник blob-елементів зберігання або власник блоґів зберігання.<br>**Рівень**: дозволи, надані для облікового запису сховища або контейнера.</br>|
|Директор служби Customer Insights -<br>Використання Azure Data Lake Storage в якості джерело даних</br>|Варіант 1<ul><li>**Роль**: Програма читання даних BLOB-сервера сховища, постачальник даних BLOB-сервера сховища або власник даних BLOB-сервера зберігання.</li><li>**Рівень**: дозволи, надані для облікового запису сховища.</li></ul>Варіант 2 *(без спільного доступу принципала послуги до облікового запису сховища)*<ul><li>**Роль 1**: Програма зчитування даних blob-панелей зберігання, постачальник даних blob-даних сховища або власник даних blob-сервера зберігання.</li><li>**Рівень**: дозволи, надані для контейнера.</li><li>**Роль 2**: Делегатор даних blob-даних сховища.</li><li>**Рівень**: дозволи, надані для облікового запису сховища.</li></ul>|
|Директор служби Customer Insights - <br>Використання Azure Data Lake Storage в якості виводу або призначення</br>|Варіант 1<ul><li>**Роль**: Постачальник даних BLOB-сервера зберігання або власник блоха зберігання.</li><li>**Рівень**: дозволи, надані для облікового запису сховища.</li></ul>Варіант 2 *(без спільного доступу принципала послуги до облікового запису сховища)*<ul><li>**Роль**: Постачальник даних BLOB-сервера зберігання або власник блоха зберігання.</li><li>**Рівень**: дозволи, надані для контейнера.</li><li>**Роль 2**: Делегатор крапель зберігання.</li><li>**Рівень**: дозволи, надані для облікового запису сховища.</li></ul>|

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com) та ввійдіть в організацію.

1. Відкрийте обліковий запис сховища, до якого потрібно надати основний компонент послуг для статистики клієнтів.

1. В області ліворуч натисніть **Керування доступом (IAM)**, а потім **Додати** > **Додати призначення ролі**.

   :::image type="content" source="media/ADLS-SP-AddRoleAssignment.png" alt-text="Знімок екрана: портал Azure під час додавання призначення ролі.":::

1. В області **Додавання призначення ролі** задайте такі властивості:
   - **Роль**: Програма читання даних BLOB-сховища, постачальник blob-сервера сховища або власник бло-кодів сховища на основі облікових даних, перелічених вище.
   - **Призначення доступу:** **Користувачу, групі або принципалу служби**
   - **Виберіть** учасників: **Dynamics 365 AI for Customer Insights (директор служби,** який [ви шукали](#create-a-new-service-principal) раніше в цій процедурі)

1. Виберіть **елемент Рецензування + призначення**.

Для впровадження змін може знадобитися до 15 хвилин.

## <a name="enter-the-azure-resource-id-or-the-azure-subscription-details-in-the-storage-account-attachment-to-customer-insights"></a>Введіть ідентифікатор ресурсу Azure або відомості про передплату Azure у вкладенні облікового запису сховища до Customer Insights

Вкладіть обліковий запис Data Lake Storage в Customer Insights, щоб [зберігати вихідні дані](manage-environments.md) або [використовувати їх як джерело даних](connect-dataverse-managed-lake.md). Виберіть підхід на [основі](#resource-based-storage-account-connection) ресурсів або підписки [та](#subscription-based-storage-account-connection) виконайте ці кроки.

### <a name="resource-based-storage-account-connection"></a>Підключення облікового запису сховища на основі ресурсу

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com), увійдіть у підписку та відкрийте обліковий запис сховища.

1. На лівій панелі перейдіть до **кінцевих точок** > **настройок**.

1. Скопіюйте значення ідентифікатора ресурсів облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-ResourceId.png" alt-text="Скопіюйте значення ідентифікатора ресурсів облікового запису сховища.":::

1. У розділі Customer Insights вставте ідентифікатор ресурсу в поле ресурсу, яке відображається на екрані підключення облікового запису сховища.

   :::image type="content" source="media/ADLS-SP-ResourceIdConnection.png" alt-text="Введіть інформацію про ідентифікатор ресурсу облікового запису сховища.":::

1. Виконайте решту кроків у Розділі Customer Insights, щоб приєднати обліковий запис сховища.

### <a name="subscription-based-storage-account-connection"></a>Підключення облікового запису сховища на основі передплати

1. Відкрийте [портал адміністратора Azure](https://portal.azure.com), увійдіть у підписку та відкрийте обліковий запис сховища.

1. В області ліворуч перейдіть до меню **Параметри** > **Властивості**.

1. Перегляньте **передплату**, **групу** ресурсів і **ім’я** облікового запису сховища, щоб переконатися, що вибрано правильні значення в Customer Insights.

1. У Customer Insights виберіть значення для відповідних полів під час вкладення облікового запису сховища.

1. Виконайте решту кроків у Розділі Customer Insights, щоб приєднати обліковий запис сховища.

[!INCLUDE [footer-include](includes/footer-banner.md)]
